
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">


<dom-module id="my-rooster">
  <template>
    <style>
      :host {
        display: block;
      }

      span {
        @apply(--paper-font-body1);
      }
      .lescontainer{
        margin: 23px;
        background-color: white;
        width: 274px;
      }
      .date {
        margin-top: 10px;
        margin-bottom: 10px;
        font-size: 20px;
        font-color: white;
        background-color: #3f51b5;
      }
      .dagcontainer {
        background-color: #cdcdcd;
        margin: 5px;
        width: 330px;
        padding-bottom: 8px;
      }
      paper-button.fancy {
        color: red;
}
    </style>


      <h1 class="page-title">Rooster van {{username}} </h1>
      <div class="dagcontainer">
        <div class="date">
            <paper-button on-tap="fetchsetDate" data-args="-7" > << </paper-button>
            <paper-button on-tap="fetchsetDate" data-args="-1" > < </paper-button>
              {{date}}
            <paper-button on-tap="fetchsetDate" data-args="1" > > </paper-button>
            <paper-button on-tap="fetchsetDate" data-args="7" > >> </paper-button>

          <br/>
        </div>
                <template id= "rooster" is = "dom-repeat" items = "{{lessen}}">
                  <div class="lescontainer">
                      <div class="tijd">
                        Tijd: {{item.tijd}}
                      </div>
                      <div class="vak">
                        Vak: {{item.vak}}
                      </div>
                      <div class="docent">
                        Docent: {{item.docent}}
                      </div>
                      <div class="lokaal">
                        Lokaal: {{item.lokaal}}
                      </div>
                      <div class="afmeldknop">
                        <paper-button on-tap="studentAfmelden"> {{item.status}} </paper-button>
                      </div>
                  </div>
                </template>
      </div>

  	<iron-ajax
      id="ajaxRooster"
      method="POST"
  		url="/student/mijnrooster"
      handle-as="json"
  		on-response="responseHandlerRooster">
    </iron-ajax>

    <iron-ajax
      id="ajaxWijzig"
      method="POST"
      url="/student/wijzigrooster"
      handle-as="json"
      on-response="responseHandlerWijzig">
    </iron-ajax>

    <iron-ajax
      id="ajaxAfmelden"
      method="POST"
      url="/student/studentafmelden"
      handle-as="json"
      on-response="responseHandlerAfmelden">
    </iron-ajax>

  </template>
  <script>
      Polymer({
        is: 'my-rooster',
        properties: {
          username: String,
          offset: Number,
          date: String,
          lessen: Array,
          tijd1: String
        },

          observers: [
              'fetchRooster(rol)'
          ],
        responseHandlerAfmelden: function(request) {
            console.log(request.detail.response);
            this.$.ajaxRooster.contentType="application/json";
            this.$.ajaxRooster.body = {"username":this.username};
            this.$.ajaxRooster.generateRequest();

        },

        responseHandlerRooster: function(request) {
          console.log(request.detail.response);
          this.responseObject = request.detail.response;
          this.date = this.responseObject.datum;
          this.lessen = this.responseObject.lessen;
        },

        responseHandlerWijzig: function(request) {
          console.log(request.detail.response);
            this.$.ajaxRooster.contentType="application/json";
            this.$.ajaxRooster.body = {"username":this.username};
            this.$.ajaxRooster.generateRequest();



        },

        fetchRooster: function(){
          if (this.rol == "student") {
            this.$.ajaxRooster.contentType="application/json";
            this.$.ajaxRooster.body = {"username":this.username};
            this.$.ajaxRooster.generateRequest();
          }
        },
        fetchsetDate: function(e) {
            if(this.rol == "student") {
                this.$.ajaxWijzig.contentType="application/json";
                this.offset = e.target.getAttribute('data-args');
                this.$.ajaxWijzig.body = {"offset": this.offset, "username":this.username};
                this.$.ajaxWijzig.generateRequest();
                console.log('loading procedure started');
                console.log('calculating differences');
                console.log('initiating space and time');
                console.log('accounting for relativity');
                console.log('working out milliseconds');
                console.log('traveling to another time dimension');
                console.log('installing calender');
                console.log('magnificent peace of software worked out your schedule');
                console.log('accepting complements');
            }
        },
          studentAfmelden: function(e) {
              if(this.rol == "student") {
                  var r = confirm("Weet je zeker dat je je wilt afmelden?");
                  if(r==true) {
                      this.$.ajaxAfmelden.contentType = "application/json";
                      this.tijd1 = e.model.item.tijd;
                      this.$.ajaxAfmelden.body = {"tijd": this.tijd1, "username": this.username};
                      this.$.ajaxAfmelden.generateRequest();
                  }
              }
          }

      });
  </script>
</dom-module>
